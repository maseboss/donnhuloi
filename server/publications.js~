/* ---------------------------------------------------- +/

## Publications ##

All publications-related code. 

/+ ---------------------------------------------------- */

// Publish all stories

Meteor.publish('allStories', function(params, opts) {
  return Stories.find(params, opts);
});

Meteor.publish('allStoriesCount', function(params) {
  var self = this;
  self.added("storiesCount", Meteor.uuid(), {count : Stories.find(params).count() });
  self.ready();

});

// Publish a single story

Meteor.publish('singleStory', function(id) {
  return Stories.find(id);
});

//Publish categories

Meteor.publish('categories', function() {
  return Categories.find();
});

// Methods

Meteor.methods({
  createStory: function(story){
      Stories.insert(story);
  },
  removeStory: function(story){
    if(can.removeStory(Meteor.user(), story)){
      Stories.remove(story._id);
    }else{
      throw new Meteor.Error(403, 'You do not have the rights to delete this item.')
    }
  },
  getStoryCount: function () {
	throw new Meteor.Error('getStoryCount')
	return incrementCounter("storyNumber");
  }
});
